<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/catalog.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="../css/tipografy.css">
    <title>Catálogo</title>
</head>
<body style="font-family: Lexend, Arial, Helvetica, sans-serif;">

    <!-- header -->
    <header id="header">
        <nav class="header-nav">
            <a href="/">
                <div class="logo">
                    <img src="../assets/images/logo-black-n-white.svg">
                </div>
            </a>

            <!-- search -->
            <div class="search-wrapper">
                <input type="text" class="header-search-input" id="searchInput" placeholder="Buscar produtos..." oninput="searchProducts()">
            </div>


            <!-- OPÇOES -->
            <div class="options-right">
                    
                <!-- atendimento -->
                <div class="header-contact-us">
                    <a style="text-decoration: none;" href="https://wa.me/555196845492" target="_blank"> <!-- Adicionado link para WhatsApp -->
                    <button class="header-contact-us-button">
                        <svg class="header-contact-us-button-icon" version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 516.000000 516.000000" preserveAspectRatio="xMidYMid meet">
                            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="#181717" stroke="none">
                                <path class="header-contact-us-button-icon-svg" d="M502 5105 c-189 -41 -361 -183 -444 -364 -61 -133 -59 -58 -56 -1734
                                l3 -1532 27 -73 c38 -105 83 -176 158 -252 76 -75 148 -120 252 -158 l73 -27
                                543 -3 542 -3 0 -415 c0 -332 3 -421 14 -448 30 -71 129 -114 198 -85 18 7
                                312 223 653 479 l620 465 760 5 760 5 72 27 c230 83 382 255 428 484 14 71 15
                                241 13 1604 l-3 1525 -27 73 c-73 201 -215 341 -418 414 l-65 23 -2020 2
                                c-1679 1 -2031 -1 -2083 -12z"/>
                            </g>
                        </svg>    
                        <div class="header-contact-us-button-text"><p>Central de <br> <strong>atendimento</strong></p></div>
                    </button>
                    </a> <!-- Fim do link -->
                </div>

                <!-- carrinho -->
                <div class="header-cart-button">
                    <svg viewBox="0 0 16 16" class="bi bi-cart-check" height="24" width="24" xmlns="http://www.w3.org/2000/svg" fill="#fff">
                        <path d="M160 64c0-11.8-6.5-22.6-16.9-28.2s-23-5-32.8 1.6l-96 64C-.5 111.2-4.4 131 5.4 145.8s29.7 18.7 44.4 8.9L96 123.8 96 416l-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0 96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-352z"></path>
                        <path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zm3.915 10L3.102 4h10.796l-1.313 7h-8.17zM6 14a1 1 0 1 1 0 0 1 2 0z7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path>
                    </svg>
                    <p class="cart-button-text">0</p>
                </div>


            </div>
        </nav>

        <div class="mobile-search-wrapper">
            <input type="text" class="header-search-input" id="searchInput" placeholder="Buscar produtos..." oninput="searchProducts()">
        </div> 
    </header>



    <h1>Catálogo de Produtos</h1>
    
    <div style="margin: 100px 10px;" id="product-list-container">
        <ul style="display: flex; list-style: none; gap: 10px; flex-wrap: wrap;" id="product-list"></ul>
    </div>

    <script>
        // Função para obter parâmetros da URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Coloca o valor do parâmetro 'search' no input
        const searchValue = getQueryParam('search');
        if (searchValue) {
            document.getElementById('searchInput').value = searchValue;
            searchProducts()
        }

        async function searchProducts() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const response = await fetch('http://localhost:3000/products');
            const data = await response.json();
            const filteredProducts = data.filter(item => 
                item.nome.toLowerCase().includes(searchText) || 
                item.categoria.toLowerCase().includes(searchText) ||
                item.descricao.toLowerCase().includes(searchText)
            );
            displayProducts(filteredProducts);
        }

        function displayProducts(products) {
            const productList = document.getElementById('product-list');
            productList.innerHTML = ''; // Limpa a lista atual

            if (products.length === 0) {
                productList.innerHTML = `
                    <li class="wrong-search-text" style="text-align: center; width: 100%; text-wrap: nowrap;">
                        <p style="font-size: 2.2em;">Não encontramos nada... :(</p>
                        <p style="font-size: 1.0em; color: #333;">Tente outro produto!</p>
                    </li>
                `;
            } else {
                products.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <div class="product-card">
                            <img src="${item.imagens[0]}" alt="${item.nome}" class="product-image">
                            <h3>${item.nome}</h3>
                            <p>Categoria: ${item.categoria}</p>
                            <p>Preço: R$ ${item.preco.toFixed(2)}</p>
                            <p>Descrição: ${item.descricao}</p>
                            <p>Disponível: ${item.disponivel ? 'Sim' : 'Não'}</p>
                        </div>
                    `;
                    productList.appendChild(listItem);
                });
            }
        }
    </script>
</body>
</html>
